{"componentChunkName":"component---src-templates-jupyter-notebook-js","path":"/data-science/mailing-list-analysis/notebooks/01_collect_data/raw_to_text.ipynb","result":{"data":{"site":{"siteMetadata":{"title":"Operate First"}},"jupyterNotebook":{"id":"6f7173de-fff3-52e7-9963-0cc8ea12bf5b >>> JupyterNotebook","html":"<div class=\"notebook-render\"><div class=\"sc-ifAKCX zMCZx\"><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-iwsKbI exQuEV markdown\"><h1>raw to text data</h1>\n<p><strong>Note: This notebook is used in automation</strong></p>\n<p>This notebook pre-process raw mbox files produced by <code>gz_to_raw.ipynb</code> and converts them to csv files that only contain the text, data, and message id fields for each email.</p>\n<p>When run directly, it will convert all mbox files in <code>raw/fedora-devel-list/</code> and save them as csv&#x27;s in <code>/interim/text/</code>. </p>\n<p>When run as part of the automation workflow, it will only pre-process the last full months worth of data and upload it to remote storage for later use.  </p></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[2]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#0000ff\">import</span> mailbox\n<span class=\"token\" style=\"color:#0000ff\">import</span> os\n<span class=\"token\" style=\"color:#0000ff\">import</span> re\n<span class=\"token\" style=\"color:#0000ff\">import</span> datetime\n<span class=\"token\" style=\"color:#0000ff\">import</span> pandas <span class=\"token\" style=\"color:#0000ff\">as</span> pd\n<span class=\"token\" style=\"color:#0000ff\">from</span> pathlib <span class=\"token\" style=\"color:#0000ff\">import</span> Path\n<span class=\"token\" style=\"color:#0000ff\">from</span> dotenv <span class=\"token\" style=\"color:#0000ff\">import</span> load_dotenv\n<span class=\"token\" style=\"color:#0000ff\">import</span> sys\n\nload_dotenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;../../.env&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nsys<span class=\"token\" style=\"color:#393A34\">.</span>path<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;../..&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n<span class=\"token\" style=\"color:#0000ff\">from</span> src <span class=\"token\" style=\"color:#0000ff\">import</span> utils  <span class=\"token\" style=\"color:#008000;font-style:italic\"># noqa</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[3]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># collect paths of either the entire dataset, or only the most recent month if running in automation</span>\n\nBASE_PATH <span class=\"token\" style=\"color:#393A34\">=</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;LOCAL_DATA_PATH&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;../../data&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\npath <span class=\"token\" style=\"color:#393A34\">=</span> Path<span class=\"token\" style=\"color:#393A34\">(</span>BASE_PATH<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>joinpath<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;raw/fedora-devel-list&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\nmboxes <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>x<span class=\"token\" style=\"color:#393A34\">.</span>name <span class=\"token\" style=\"color:#0000ff\">for</span> x <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">list</span><span class=\"token\" style=\"color:#393A34\">(</span>path<span class=\"token\" style=\"color:#393A34\">.</span>glob<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;*.mbox&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;RUN_IN_AUTOMATION&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    LAST_MONTH_DATE <span class=\"token\" style=\"color:#393A34\">=</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>datetime<span class=\"token\" style=\"color:#393A34\">.</span>now<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        day<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">-</span> datetime<span class=\"token\" style=\"color:#393A34\">.</span>timedelta<span class=\"token\" style=\"color:#393A34\">(</span>days<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    y <span class=\"token\" style=\"color:#393A34\">=</span> LAST_MONTH_DATE<span class=\"token\" style=\"color:#393A34\">.</span>year\n    m <span class=\"token\" style=\"color:#393A34\">=</span> LAST_MONTH_DATE<span class=\"token\" style=\"color:#393A34\">.</span>month\n    mboxes <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>x<span class=\"token\" style=\"color:#393A34\">.</span>name <span class=\"token\" style=\"color:#0000ff\">for</span> x <span class=\"token\" style=\"color:#0000ff\">in</span> <span class=\"token builtin\">list</span><span class=\"token\" style=\"color:#393A34\">(</span>path<span class=\"token\" style=\"color:#393A34\">.</span>glob<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;*</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>y<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">-</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>m<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.mbox&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">]</span></code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[4]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Define a function to convert mbox data into row,column format for analysis</span>\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># using pandas</span>\n\n\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">mbox_to_text</span><span class=\"token\" style=\"color:#393A34\">(</span>mbox<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n\n    csv <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">for</span> msg <span class=\"token\" style=\"color:#0000ff\">in</span> mbox<span class=\"token\" style=\"color:#393A34\">:</span>\n        msg_id <span class=\"token\" style=\"color:#393A34\">=</span> msg<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Message-ID&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        date <span class=\"token\" style=\"color:#393A34\">=</span> msg<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Date&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        body <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n        <span class=\"token\" style=\"color:#0000ff\">for</span> m <span class=\"token\" style=\"color:#0000ff\">in</span> msg<span class=\"token\" style=\"color:#393A34\">.</span>get_payload<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n            body<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>m<span class=\"token\" style=\"color:#393A34\">.</span>get_payload<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n        csv<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">(</span>msg_id<span class=\"token\" style=\"color:#393A34\">,</span> date<span class=\"token\" style=\"color:#393A34\">,</span> body<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> pd<span class=\"token\" style=\"color:#393A34\">.</span>DataFrame<span class=\"token\" style=\"color:#393A34\">(</span>csv<span class=\"token\" style=\"color:#393A34\">,</span> columns<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Message-ID&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;Date&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> df</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[9]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Clean the data before storing it</span>\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">strip_thread</span><span class=\"token\" style=\"color:#393A34\">(</span>text<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    text <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>text<span class=\"token\" style=\"color:#393A34\">)</span>\n    text <span class=\"token\" style=\"color:#393A34\">=</span> text<span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;\\r&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> text<span class=\"token\" style=\"color:#393A34\">.</span>split<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token builtin\">len</span><span class=\"token\" style=\"color:#393A34\">(</span>line<span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#393A34\">&gt;</span> <span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;&gt;&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">3</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Re:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Subject&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">5</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;From:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">5</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Date:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;BEGIN PGP SIGNED MESSAGE&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">5</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Hash:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Version: G&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;wrote:&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;wrote :&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;writes:&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Am Mit,&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Am Don,&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Am Mon,&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Quoting&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#36acaa\">10</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;Em Quinta,&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> <span class=\"token\" style=\"color:#A31515\">&quot;said:&quot;</span> <span class=\"token\" style=\"color:#0000ff\">not</span> <span class=\"token\" style=\"color:#0000ff\">in</span> line<span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n        line\n        <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#A31515\">&quot;.*n (Sun|Mon|Tue|Wed|Thu|Fri|Sat), .. (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec) 20..*&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            line<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n    <span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n        line\n        <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#393A34\">(</span>\n                <span class=\"token\" style=\"color:#A31515\">&quot;.*n (Sunday|Monday|Tuesday|Wednesday|Thursday|Friday|Saturday) ..&quot;</span>\n                <span class=\"token\" style=\"color:#A31515\">&quot; (January|February|March|April|May|June|July|August|September|October|November|December) 20..*&quot;</span>\n            <span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            line<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n    <span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n        line\n        <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#A31515\">&quot;.*n (Sun|Mon|Tue|Wed|Thu|Fri|Sat), (Jan|Feb|Mar|Apr|May|Jun|Jul|Aug|Sep|Sept|Oct|Nov|Dec) .., 20..*&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            line<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n    <span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>\n        line\n        <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines\n        <span class=\"token\" style=\"color:#0000ff\">if</span> re<span class=\"token\" style=\"color:#393A34\">.</span>match<span class=\"token\" style=\"color:#393A34\">(</span>\n            <span class=\"token\" style=\"color:#A31515\">r&quot;.*n (Sun|Mon|Tue|Wed|Thu|Fri|Sat), 20[\\d]{2}-[\\d]{2}-[\\d]{2} at.*&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            line<span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">)</span>\n        <span class=\"token\" style=\"color:#0000ff\">is</span> <span class=\"token\" style=\"color:#36acaa\">None</span>\n    <span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">6</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;said: &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">8</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;babbled:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">7</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;wrot=e:&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">-</span><span class=\"token\" style=\"color:#36acaa\">8</span><span class=\"token\" style=\"color:#393A34\">:</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;A9crit :&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    lines <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span>line <span class=\"token\" style=\"color:#0000ff\">for</span> line <span class=\"token\" style=\"color:#0000ff\">in</span> lines <span class=\"token\" style=\"color:#0000ff\">if</span> line<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#36acaa\">0</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">!=</span> <span class=\"token\" style=\"color:#A31515\">&quot;|&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> <span class=\"token\" style=\"color:#A31515\">&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">.</span>join<span class=\"token\" style=\"color:#393A34\">(</span>lines<span class=\"token\" style=\"color:#393A34\">)</span>\n\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># format for CSV, clean special characters, and remove extranous emails</span>\n<span class=\"token\" style=\"color:#0000ff\">def</span> <span class=\"token\" style=\"color:#393A34\">pandas_clean</span><span class=\"token\" style=\"color:#393A34\">(</span>emails<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span>\n            <span class=\"token\" style=\"color:#A31515\">r&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n            <span class=\"token\" style=\"color:#A31515\">&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        <span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">r&quot;\\&#x27;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&#x27;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&gt;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&lt;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;= &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;-&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">r&quot;http\\S+&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n        inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">r&quot;\\\\\\s+&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">r&quot;\\\\s+&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;=&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;   &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;  &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;_&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;3D&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;   &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;  &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span>\n        to_replace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;   &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;  &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> value<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> regex<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>\n        <span class=\"token\" style=\"color:#0000ff\">lambda</span> x<span class=\"token\" style=\"color:#393A34\">:</span> x<span class=\"token\" style=\"color:#393A34\">.</span>strip<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>replace<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">r&quot;\\n&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#393A34\">)</span>\n\n    emails<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span>emails<span class=\"token\" style=\"color:#393A34\">.</span>index<span class=\"token\" style=\"color:#393A34\">[</span>emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot;&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span>emails<span class=\"token\" style=\"color:#393A34\">.</span>index<span class=\"token\" style=\"color:#393A34\">[</span>emails<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">==</span> <span class=\"token\" style=\"color:#A31515\">&quot; &quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">.</span>dropna<span class=\"token\" style=\"color:#393A34\">(</span>subset<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n    emails <span class=\"token\" style=\"color:#393A34\">=</span> emails<span class=\"token\" style=\"color:#393A34\">.</span>reset_index<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    emails<span class=\"token\" style=\"color:#393A34\">.</span>drop<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;index&quot;</span><span class=\"token\" style=\"color:#393A34\">,</span> axis<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">1</span><span class=\"token\" style=\"color:#393A34\">,</span> inplace<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">return</span> emails</code></pre></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[10]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Ensure datset location exists</span>\ndataset_base_path <span class=\"token\" style=\"color:#393A34\">=</span> Path<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>BASE_PATH<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">/interim/text&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\ndataset_base_path<span class=\"token\" style=\"color:#393A34\">.</span>mkdir<span class=\"token\" style=\"color:#393A34\">(</span>parents<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">,</span> exist_ok<span class=\"token\" style=\"color:#393A34\">=</span><span class=\"token\" style=\"color:#36acaa\">True</span><span class=\"token\" style=\"color:#393A34\">)</span>\n\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Register all created dataset slices for later upload</span>\nnew_files <span class=\"token\" style=\"color:#393A34\">=</span> <span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#393A34\">]</span>\n\n<span class=\"token\" style=\"color:#008000;font-style:italic\"># Save each dataset into its own monthly csv</span>\n<span class=\"token\" style=\"color:#0000ff\">for</span> mbox <span class=\"token\" style=\"color:#0000ff\">in</span> mboxes<span class=\"token\" style=\"color:#393A34\">:</span>\n    output_path <span class=\"token\" style=\"color:#393A34\">=</span> dataset_base_path<span class=\"token\" style=\"color:#393A34\">.</span>joinpath<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>mbox<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">.csv&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span>\n    monthly_mbox <span class=\"token\" style=\"color:#393A34\">=</span> mailbox<span class=\"token\" style=\"color:#393A34\">.</span>mbox<span class=\"token\" style=\"color:#393A34\">(</span>path<span class=\"token\" style=\"color:#393A34\">.</span>joinpath<span class=\"token\" style=\"color:#393A34\">(</span>mbox<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">)</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> mbox_to_text<span class=\"token\" style=\"color:#393A34\">(</span>monthly_mbox<span class=\"token\" style=\"color:#393A34\">)</span>\n    df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span> <span class=\"token\" style=\"color:#393A34\">=</span> df<span class=\"token\" style=\"color:#393A34\">[</span><span class=\"token\" style=\"color:#A31515\">&quot;Body&quot;</span><span class=\"token\" style=\"color:#393A34\">]</span><span class=\"token\" style=\"color:#393A34\">.</span><span class=\"token builtin\">apply</span><span class=\"token\" style=\"color:#393A34\">(</span>strip_thread<span class=\"token\" style=\"color:#393A34\">)</span>\n    df <span class=\"token\" style=\"color:#393A34\">=</span> pandas_clean<span class=\"token\" style=\"color:#393A34\">(</span>df<span class=\"token\" style=\"color:#393A34\">)</span>\n    df<span class=\"token\" style=\"color:#393A34\">.</span>to_csv<span class=\"token\" style=\"color:#393A34\">(</span>output_path<span class=\"token\" style=\"color:#393A34\">)</span>\n    new_files<span class=\"token\" style=\"color:#393A34\">.</span>append<span class=\"token\" style=\"color:#393A34\">(</span>output_path<span class=\"token\" style=\"color:#393A34\">)</span>\n    <span class=\"token\" style=\"color:#0000ff\">print</span><span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>output_path<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\"> saved&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div><div class=\"sc-htoDjs wOXyQ nteract-outputs\" style=\"max-height:100%\"><div class=\"cell_display\" style=\"max-height:100%;overflow-y:auto\"><code class=\"nteract-display-area-stdout\"><span>../../data/interim/text/fedora-devel-2020-12.mbox.csv saved\n../../data/interim/text/fedora-devel-2021-2.mbox.csv saved\n../../data/interim/text/fedora-devel-2021-1.mbox.csv saved\n</span></code></div></div></div><div class=\"sc-bxivhb HLmih cell\" style=\"box-shadow:none\"><div class=\"sc-gzVnrw iiEGBE input-container\"><div class=\"sc-bwzfXH jsVRSS prompt\">[6]</div><pre class=\"sc-bZQynM dQAqiJ input\" style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none;padding:10px 0px 10px 10px;margin:0px;overflow:auto;border:none;background-color:var(--cm-background, #fafafa)\"><code style=\"color:#393A34;font-family:&quot;Consolas&quot;, &quot;Bitstream Vera Sans Mono&quot;, &quot;Courier New&quot;, Courier, monospace;direction:ltr;text-align:left;white-space:pre;word-spacing:normal;word-break:normal;font-size:0.95em;line-height:1.2em;-moz-tab-size:4;-o-tab-size:4;tab-size:4;-webkit-hyphens:none;-moz-hyphens:none;-ms-hyphens:none;hyphens:none\"><span class=\"token\" style=\"color:#008000;font-style:italic\"># Push all the files to ceph</span>\n\n<span class=\"token\" style=\"color:#0000ff\">if</span> os<span class=\"token\" style=\"color:#393A34\">.</span>getenv<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#A31515\">&quot;RUN_IN_AUTOMATION&quot;</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">:</span>\n    utils<span class=\"token\" style=\"color:#393A34\">.</span>upload_files<span class=\"token\" style=\"color:#393A34\">(</span>\n        <span class=\"token\" style=\"color:#393A34\">(</span>f<span class=\"token\" style=\"color:#393A34\">.</span>as_posix<span class=\"token\" style=\"color:#393A34\">(</span><span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">,</span> <span class=\"token string-interpolation\"><span class=\"token\" style=\"color:#A31515\">f&quot;interim/text/</span><span class=\"token interpolation\"><span class=\"token\" style=\"color:#393A34\">{</span>Path<span class=\"token\" style=\"color:#393A34\">(</span>f<span class=\"token\" style=\"color:#393A34\">)</span><span class=\"token\" style=\"color:#393A34\">.</span>name<span class=\"token\" style=\"color:#393A34\">}</span></span><span class=\"token\" style=\"color:#A31515\">&quot;</span></span><span class=\"token\" style=\"color:#393A34\">)</span> <span class=\"token\" style=\"color:#0000ff\">for</span> f <span class=\"token\" style=\"color:#0000ff\">in</span> new_files\n    <span class=\"token\" style=\"color:#393A34\">)</span></code></pre></div></div></div></div>","fields":{"srcLink":"https://github.com/aicoe-aiops/mailing-list-analysis-toolkit/blob/master/notebooks/01_collect_data/raw_to_text.ipynb"}}},"pageContext":{"id":"6f7173de-fff3-52e7-9963-0cc8ea12bf5b >>> JupyterNotebook"}},"staticQueryHashes":["117426894","3000541721","533861647"]}